!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o=function(){return!!(document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},r=function(){o()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)},u=function(){return void 0!==document.createElement("progress").max};function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e){var t="function"==typeof Map?new Map:void 0;return(s=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return d(e,arguments,m(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),p(o,e)})(e)}function d(e,t,n){return(d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&p(r,n.prototype),r}).apply(null,arguments)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){function t(){var e,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=m(t).call(this),e=!o||"object"!==l(o)&&"function"!=typeof o?c(n):o,Object.defineProperties(c(c(e)),{state:{value:e.setup(),writable:!0},setState:{value:function(t){for(var n in t)t.hasOwnProperty(n)&&(e.state[n]=t[n]);e.render()}},onProgressClick:{value:function(t){var n=e.state.videoTemplate,o=t.target,r=(t.pageX-(o.offsetLeft+o.offsetParent.offsetLeft))/o.offsetWidth;n.currentTime=r*n.duration}},onPlayClick:{value:function(){e.togglePlayPause()}},onVolumeClick:{value:function(){var t=e.state.videoTemplate;e.changeVolume(t.muted?100:0)}},onVolumeHover:{value:function(){e.state.controls.volume.volumeSlider.setAttribute("data-state","open")}},onVolumeLeave:{value:function(){e.state.controls.volume.volumeSlider.setAttribute("data-state","close")}},onVolumeChange:{value:function(t){e.changeVolume(t.target.value)}},onFullscreenClick:{value:function(){r(),e.changeButtonState("fullscreen")}},onVideoClick:{value:function(){e.togglePlayPause()}},onLoadedMetadata:{value:function(){var t=e.state.controls,n=e.state.videoTemplate;t.progress.progressElement.setAttribute("max",n.duration),t.volume.volumeSlider.setAttribute("value",100*n.volume),e.changeButtonState("mute")}},onTimeUpdate:{value:function(){var t=e.state,n=t.srcmap[t.current],o=t.videoTemplate,r=e.state.controls.progress;if(r.progressElement.value=o.currentTime,r.progressValue.style.width=Math.floor(o.currentTime/o.duration*100)+"%",n.options){var u=n.options.timeout,l=u||10;o.duration-o.currentTime<=l&&(t.videoAttrs.controls&&t.controls.controlsTemplate.setAttribute("data-state","hidden"),t.choicesTemplate.setAttribute("data-state","visible"))}}},onVideoEnded:{value:function(){var t=e.state;t.next&&(e.setAttribute("current",t.next),t.videoAttrs.controls&&t.controls.controlsTemplate.setAttribute("data-state","visible"),t.choicesTemplate.setAttribute("data-state","hidden"))}},onChoiceSelected:{value:function(t){e.setAttribute("next",t),e.state.next=t}},onKeydown:{value:function(e){70===e.keyCode&&r()}}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,s(HTMLElement)),a(t,null,[{key:"observedAttributes",get:function(){return["srcmap","current"]}}]),a(t,[{key:"connectedCallback",value:function(){this.render()}},{key:"attributeChangedCallback",value:function(e,t,n){var o,r,u;null!==t&&this.setState((o={},r=e,u="srcmap"===e?JSON.parse(n):n,r in o?Object.defineProperty(o,r,{value:u,enumerable:!0,configurable:!0,writable:!0}):o[r]=u,o))}},{key:"setup",value:function(){var e={autoplay:this.hasAttribute("autoplay")||null,controls:this.hasAttribute("controls")||null,muted:this.hasAttribute("muted")||null,playsinline:this.hasAttribute("playsinline")||null,poster:this.getAttribute("poster"),preload:this.getAttribute("preload")},t=JSON.parse(this.getAttribute("srcmap")),n=this.getAttribute("next")||"",o=this.getAttribute("current");o||(o=Object.keys(t)[0],this.setAttribute("current",o));var r,l,i,a=((r=document.createElement("div")).setAttribute("class","ivid ivid__wrapper"),r),c=((l=this.firstElementChild)||(l=document.createElement("video")),l.classList.add("ivid__video"),l),s=((i=document.createElement("div")).setAttribute("class","ivid__choice-wrapper"),i.setAttribute("data-state","hidden"),i),d=function(){var e=document.createElement("div");e.setAttribute("class","ivid__ctrls-wrapper");var t=document.createElement("div");t.setAttribute("class","ivid__ctrls-progress");var n=document.createElement("progress");u()||n.setAttribute("data-state","pollyfill");var o=document.createElement("span");u()||o.setAttribute("data-state","pollyfill");var r={progressWrapper:t,progressElement:n,progressValue:o},l=document.createElement("div");l.setAttribute("class","ivid__ctrls-buttons-wrapper");var i=document.createElement("button");i.setAttribute("data-state","pause"),i.setAttribute("class","ivid__ctrls-button material-icons");var a=document.createElement("div");a.setAttribute("class","ivid__ctrls-volume-wrapper");var c=document.createElement("button");c.setAttribute("data-state","volume_up"),c.setAttribute("class","ivid__ctrls-button material-icons");var s=document.createElement("input");s.setAttribute("data-state","close"),s.setAttribute("class","ivid__ctrls-volume"),s.type="range",s.min=0,s.max=100,s.step=1;var d={volumeWrapper:a,volumeButton:c,volumeSlider:s},p=document.createElement("div");p.setAttribute("class","ivid__ctrls-spacer");var m=document.createElement("button");return m.setAttribute("data-state","fullscreen"),m.setAttribute("class","ivid__ctrls-button material-icons"),t.appendChild(n),t.appendChild(o),a.appendChild(c),a.appendChild(s),l.appendChild(i),l.appendChild(a),l.appendChild(p),l.appendChild(m),e.appendChild(t),e.appendChild(l),{controlsTemplate:e,progress:r,playButton:i,volume:d,fullscreenButton:m}}();return this.innerHTML="",a.appendChild(c),a.appendChild(s),a.appendChild(d.controlsTemplate),this.appendChild(a),{videoAttrs:e,srcmap:t,next:n,current:o,baseTemplate:a,videoTemplate:c,choicesTemplate:s,controls:d}}},{key:"render",value:function(){var e,t,n,o,r,u,l,i,a,c,s,d,p=this.state,m=p.srcmap[p.current];if(m.options){var f=m.options.fallback||Object.keys(m.options.choices)[0];this.onChoiceSelected(f),m.options.choices&&(e=p.choicesTemplate,t=m,n=this.onChoiceSelected,o=t.options.choices,e.setAttribute("data-state","hidden"),e.innerHTML="",Object.keys(o).map(function(t){var r=document.createElement("button");r.setAttribute("class","ivid__choice-button"),r.innerHTML=o[t],r.onclick=function(){return n(t)},e.appendChild(r)}))}else this.onChoiceSelected(null);!function(e,t,n,o,r,u,l){e.id=n.uid,e.src=n.src,t.autoplay&&(e.autoplay=!0),t.muted&&(e.muted=!0),t.playsinline&&(e.playsinline=!0),t.poster&&(e.poster=t.poster),t.preload&&(e.preload=t.preload),e.onclick=function(e){return o(e)},e.onloadedmetadata=function(){return r()},l&&(e.ontimeupdate=function(){return l()}),u&&(e.onended=function(){return u()})}(p.videoTemplate,p.videoAttrs,m,this.onVideoClick,this.onLoadedMetadata,m.options?this.onVideoEnded:null,m.options?this.onTimeUpdate:null),r=p.controls,u=this.onProgressClick,l=this.onPlayClick,i=this.onVolumeClick,a=this.onVolumeHover,c=this.onVolumeLeave,s=this.onVolumeChange,d=this.onFullscreenClick,r.progress.progressWrapper.onclick=function(e){return u(e)},r.playButton.onclick=function(){return l()},r.volume.volumeWrapper.onmouseover=function(){return a()},r.volume.volumeWrapper.onmouseleave=function(){return c()},r.volume.volumeButton.onclick=function(){return i()},r.volume.volumeSlider.oninput=function(e){return s(e)},r.volume.volumeSlider.onchange=function(e){return s(e)},r.fullscreenButton.onclick=function(){return d()}}},{key:"togglePlayPause",value:function(){var e=this.state.videoTemplate;e.paused?e.play():e.pause(),this.changeButtonState("play")}},{key:"changeVolume",value:function(e){var t=this.state.videoTemplate;t.volume=e/100,console.log(t.volume),t.muted=e<=0,this.changeButtonState("mute")}},{key:"changeButtonState",value:function(e){var t=this.state.videoTemplate,n=this.state.controls;switch(e){case"play":n.playButton.setAttribute("data-state",t.paused||t.ended?"play_arrow":"pause");break;case"mute":n.volume.volumeButton.setAttribute("data-state",t.muted?"volume_off":t.volume>=.5?"volume_up":"volume_down");break;case"fullscreen":n.fullscreenButton.setAttribute("data-state",o()?"fullscreen":"fullscreen_exit")}}}]),t}();customElements.define("i-video",f)}]);